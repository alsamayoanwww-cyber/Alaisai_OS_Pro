<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø§Ù„Ø¹ÙŠØ³Ø§Ø¦ÙŠ Ø¨Ø±Ùˆ - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4cc9f0">
    
    <style>
        /* ========== STYLE.CSS - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-main: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            --glass: rgba(255, 255, 255, 0.1);
            --glass-heavy: rgba(255, 255, 255, 0.2);
            --accent: #4cc9f0;
            --success: #4ade80;
            --danger: #f72585;
            --text: #ffffff;
            --admin-bg: #1e1e26;
            --code-bg: #1a1a2e;
            --editor-bg: #282a36;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: var(--bg-main);
            color: var(--text);
            user-select: none;
        }

        #status-bar {
            height: 40px;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid var(--glass);
            z-index: 100;
        }

        #sync-indicator {
            color: var(--danger);
            transition: 0.5s;
            margin-left: 8px;
        }
        #sync-indicator.online { color: var(--success); text-shadow: 0 0 10px var(--success); }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 25px;
            padding: 30px;
            height: calc(100vh - 100px);
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent) var(--glass);
        }

        .grid-container::-webkit-scrollbar {
            width: 6px;
        }
        .grid-container::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        .app-card {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            position: relative;
        }
        .app-card:active { transform: scale(0.9); }
        .app-card[draggable="true"] { cursor: grab; }
        .app-card:active { cursor: grabbing; }
        .app-card.drag-over { border: 2px dashed var(--accent); transform: scale(1.1); border-radius: 12px; }

        .icon-box {
            width: 65px;
            height: 65px;
            background: var(--glass);
            border-radius: 16px;
            border: 1px solid var(--glass-heavy);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            backdrop-filter: blur(5px);
        }

        .app-name {
            margin-top: 8px;
            font-size: 0.85rem;
            text-align: center;
            font-weight: 500;
            color: var(--text);
            text-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
        .admin-panel, .admin-ui {
            background: var(--admin-bg);
            color: white;
            padding: 20px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            direction: rtl;
        }

        .admin-item, .admin-row {
            display: flex;
            align-items: center;
            background: rgba(255,255,255,0.05);
            margin: 10px 0;
            padding: 12px;
            border-radius: 12px;
            gap: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .btn-save-mini { background: #4cc9f0; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .btn-save-mini.saved { background: #4ade80; }
        
        .adm-btn {
            background: rgba(76, 201, 240, 0.2);
            border: 1px solid var(--accent);
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.2s;
            margin: 2px;
        }
        .adm-btn:hover {
            background: var(--accent);
            color: black;
        }

        .hidden { display: none !important; }

        /* Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø³Ø±Ø­ */
        #stage-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .window-frame {
            width: 95%;
            height: 90%;
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            color: #333;
            display: flex;
            flex-direction: column;
        }
        .window-toolbar {
            background: #222;
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .close-btn {
            background: var(--danger);
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            padding: 5px 10px;
        }
        #stage-viewport {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: white;
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© */
        #digital-clock {
            font-family: monospace;
            font-size: 1.1rem;
            letter-spacing: 2px;
        }

        .brand-name {
            font-weight: bold;
            margin-right: 10px;
        }

        #admin-view {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 12px;
            min-height: 250px;
            color: white;
        }

        #admin-view input, #admin-view textarea {
            background: rgba(255,255,255,0.9);
            border: 1px solid var(--accent);
            border-radius: 5px;
            padding: 5px;
            color: #333;
        }

        /* Ù…Ø­Ø±Ø± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ */
        .code-editor {
            width: 100%;
            min-height: 300px;
            background: var(--editor-bg);
            color: #f8f8f2;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 15px;
            border: 2px solid var(--accent);
            border-radius: 10px;
            direction: ltr;
            text-align: left;
            white-space: pre;
            overflow-x: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: 0.2s;
        }
        .file-item:hover {
            background: rgba(76,201,240,0.2);
            transform: translateX(-5px);
        }

        .file-actions {
            display: flex;
            gap: 5px;
        }

        .file-btn {
            background: none;
            border: 1px solid var(--accent);
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        .file-btn:hover {
            background: var(--accent);
            color: black;
        }

        .file-btn.delete:hover {
            background: var(--danger);
            border-color: var(--danger);
        }

        .isolated-lab {
            background: var(--code-bg);
            border: 2px dashed var(--accent);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .lab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: var(--accent);
        }

        .lab-content {
            background: white;
            border-radius: 8px;
            padding: 15px;
            min-height: 200px;
            color: #333;
        }
    </style>
</head>
<body>

<div id="os-root">
    <header id="status-bar">
        <div class="right-section">
            <span id="sync-indicator">â—</span>
            <span class="brand-name">AL-AISAI PRO</span>
        </div>
        <div id="digital-clock">00:00</div>
        <div class="left-section">
            <div id="admin-gate" onclick="Admin.requestAccess()" style="cursor:pointer; font-size:1.5rem;">âš™ï¸</div>
        </div>
    </header>

    <main id="desktop">
        <div id="app-grid" class="grid-container"></div>
    </main>

    <div id="stage-overlay" class="hidden">
        <div class="window-frame">
            <nav class="window-toolbar">
                <span id="active-app-title">Ø§Ù„Ù†Ø¸Ø§Ù…</span>
                <button onclick="AlaisaiOS.closeStage()" class="close-btn">âœ– Ø¥ØºÙ„Ø§Ù‚</button>
            </nav>
            <div id="stage-viewport"></div>
        </div>
    </div>
</div>

<script>
    // ========== CORE.JS - Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø§Ù„Ù…ÙˆØ­Ø¯ ==========
    // ğŸ›¡ï¸ Ø¯Ø±Ø¹ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    window.onerror = function(msg, url, line, col, error) {
        console.warn(`ğŸ›¡ï¸ Alaisai Shield: ØªÙ… Ø§Ø­ØªÙˆØ§Ø¡ Ø®Ø·Ø£: ${msg}`);
        return true;
    };

    // ğŸ’¾ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
    const AUTO_BACKUP_KEY = 'alaisai_auto_backup';
    
    // ğŸ§  Ø§Ù„Ù†ÙˆØ§Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    const AlaisaiOS = {
        // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©
        db: (() => {
            try {
                return JSON.parse(localStorage.getItem('alaisai_ultra_db')) || {
                    config: { 
                        pass: "1234", 
                        downloads: 1050, 
                        reports: [{ id: Date.now(), email: "support@alaisai.com", text: "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯" }] 
                    },
                    registry: [
                        { id: 'app_1', name: 'Ø§Ù„ØªØ±Ø­ÙŠØ¨', icon: 'âœ¨', content: '<div style="padding:20px;text-align:center;background:linear-gradient(135deg,#667eea,#764ba2);border-radius:15px;color:white;"><h1>Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ</h1><p>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¹ÙŠØ³Ø§Ø¦ÙŠ Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„.</p><button onclick="alert(\'Ù…Ø±Ø­Ø¨Ø§Ù‹!\')" style="padding:10px 20px;border:none;border-radius:8px;background:#4ade80;color:white;cursor:pointer;">Ø§Ù†Ù‚Ø± Ù‡Ù†Ø§</button></div>', order: 0 },
                        { id: 'app_2', name: 'Ø§Ù„Ù…ØªØµÙØ­', icon: 'ğŸŒ', content: '<iframe sandbox="allow-scripts allow-same-origin allow-forms" src="https://www.bing.com" style="width:100%;height:100vh;border:none;"></iframe>', order: 1 },
                        { id: 'app_3', name: 'Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª', icon: 'ğŸ“', content: '<div style="padding:20px;"><h2>ğŸ“‹ Ø¯ÙØªØ± Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2><textarea id="note-area" style="width:100%;height:300px;padding:15px;border-radius:10px;border:1px solid #ccc;font-size:16px;" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø§ØªÙƒ Ù‡Ù†Ø§..."></textarea><button onclick="localStorage.setItem(\'saved_note\', document.getElementById(\'note-area\').value);alert(\'ØªÙ… Ø§Ù„Ø­ÙØ¸!\')" style="margin-top:10px;padding:10px 20px;background:#4cc9f0;border:none;border-radius:8px;color:white;">ğŸ’¾ Ø­ÙØ¸</button></div>', order: 2 }
                    ]
                };
            } catch (e) {
                return { config: { pass: "1234", downloads: 0, reports: [] }, registry: [] };
            }
        })(),

        dragIdx: null,
        backupTimer: null,

        // ğŸš€ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…
        init() {
            this.createAutoBackup();
            this.renderDesktop();
            this.startClock();
            this.checkNetwork();
            window.addEventListener('online', () => this.checkNetwork());
            window.addEventListener('offline', () => this.checkNetwork());
            this.registerServiceWorker();
            this.save();
        },

        // ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        save() {
            localStorage.setItem('alaisai_ultra_db', JSON.stringify(this.db));
        },

        // â° Ù†Ø³Ø® Ø§Ø­ØªÙŠØ§Ø·ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
        createAutoBackup() {
            if (this.backupTimer) clearInterval(this.backupTimer);
            this.backupTimer = setInterval(() => {
                const backup = {
                    timestamp: new Date().toISOString(),
                    data: this.db
                };
                localStorage.setItem(AUTO_BACKUP_KEY, JSON.stringify(backup));
                console.log('âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©');
            }, 300000); // 5 Ø¯Ù‚Ø§Ø¦Ù‚
        },

        // ğŸ–¥ï¸ Ø¹Ø±Ø¶ Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨
        renderDesktop() {
            const grid = document.getElementById('app-grid');
            if (!grid) return;
            grid.innerHTML = "";
            const sorted = [...this.db.registry].sort((a, b) => a.order - b.order);
            
            sorted.forEach((app, i) => {
                const card = document.createElement('div');
                card.className = "app-card";
                card.setAttribute('draggable', 'true');
                card.innerHTML = `<div class="icon-box">${app.icon}</div><span class="app-name">${app.name}</span>`;
                
                card.ondragstart = (e) => {
                    e.dataTransfer.setData('text/plain', i);
                    this.dragIdx = i;
                    e.target.style.opacity = '0.5';
                };
                
                card.ondragend = (e) => {
                    e.target.style.opacity = '1';
                };
                
                card.ondragover = (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                };
                
                card.ondrop = (e) => {
                    e.preventDefault();
                    const fromIdx = parseInt(e.dataTransfer.getData('text/plain'));
                    const toIdx = i;
                    if (fromIdx === toIdx) return;
                    
                    const items = [...this.db.registry].sort((a, b) => a.order - b.order);
                    const [moved] = items.splice(fromIdx, 1);
                    items.splice(toIdx, 0, moved);
                    
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ±ØªÙŠØ¨
                    this.db.registry = items.map((item, idx) => {
                        item.order = idx;
                        return item;
                    });
                    
                    this.save();
                    this.renderDesktop();
                };

                card.onclick = () => this.openApp(app);
                grid.appendChild(card);
            });
        },

        // ğŸ“± ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        openApp(app) {
            const stage = document.getElementById('stage-overlay');
            const viewport = document.getElementById('stage-viewport');
            document.getElementById('active-app-title').innerText = app.name;
            
            // ØªØ·Ù‡ÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰
            viewport.innerHTML = `<div style="height:100%;">${app.content}</div>`;
            stage.classList.remove('hidden');
        },

        // ğŸšª Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø³Ø±Ø­
        closeStage() {
            document.getElementById('stage-overlay').classList.add('hidden');
            document.getElementById('stage-viewport').innerHTML = "";
        },

        // â° Ø§Ù„Ø³Ø§Ø¹Ø©
        startClock() {
            const update = () => {
                const now = new Date();
                document.getElementById('digital-clock').innerText = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
            };
            update();
            setInterval(update, 1000);
        },

        // ğŸŒ Ø­Ø§Ù„Ø© Ø§Ù„Ø´Ø¨ÙƒØ©
        checkNetwork() {
            const dot = document.getElementById('sync-indicator');
            if (dot) {
                dot.style.color = navigator.onLine ? "#4ade80" : "#f72585";
                dot.title = navigator.onLine ? 'Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª' : 'ØºÙŠØ± Ù…ØªØµÙ„ - ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„ Ù†Ø´Ø·';
            }
        },

        // ğŸ“² ØªØ³Ø¬ÙŠÙ„ Service Worker
        registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('âœ… PWA: Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª'))
                    .catch(err => console.log('âŒ PWA: ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©', err));
            }
        },

        // ========== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† ÙˆØ§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„ ==========
        StorageSystem: {
            // Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„
            structure: (() => {
                try {
                    return JSON.parse(localStorage.getItem('alaisai_storage_isolation')) || {
                        system: {
                            name: 'Ø§Ù„Ù†Ø¸Ø§Ù…',
                            path: '/system',
                            files: [
                                { name: 'config.json', size: '2KB', type: 'json', content: '{\n  "version": "1.0.0",\n  "name": "Alaisai System"\n}' },
                                { name: 'manifest.json', size: '1KB', type: 'json', content: '{\n  "short_name": "AlaisaiPro",\n  "name": "Ø§Ù„Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ©"\n}' },
                                { name: 'sw.js', size: '4KB', type: 'javascript', content: '// Service Worker\nconst CACHE_NAME = "alaisai-v1";\nself.addEventListener("install", e => {\n  e.waitUntil(caches.open(CACHE_NAME).then(cache => cache.addAll(["./"])));\n});' }
                            ],
                            folders: []
                        },
                        addons: {
                            name: 'Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª',
                            path: '/addons',
                            files: [],
                            folders: []
                        }
                    };
                } catch (e) {
                    return null;
                }
            })(),

            // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„
            openStorageExplorer() {
                const storageContent = `
                    <div class="admin-ui" style="direction:ltr; text-align:left; max-width:800px; margin:0 auto; background:#1e1e26; color:white;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                            <h2 style="color:#4cc9f0;">ğŸ“ Ù…Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„</h2>
                            <div>
                                <button onclick="AlaisaiOS.StorageSystem.refresh()" class="adm-btn" style="background:#4cc9f0;">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
                                <button onclick="AlaisaiOS.StorageSystem.isolateAddon()" class="adm-btn" style="background:#4ade80;">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø²ÙˆÙ„Ø©</button>
                            </div>
                        </div>
                        
                        <div style="display:grid; grid-template-columns:1fr 2fr; gap:20px;">
                            <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ù„Ù„Ù…Ø¬Ù„Ø¯Ø§Øª -->
                            <div style="background:#2a2a32; border-radius:10px; padding:15px;">
                                <h3 style="color:#4cc9f0; margin-bottom:15px;">ğŸ“‚ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª</h3>
                                <div onclick="AlaisaiOS.StorageSystem.openSystemFolder()" style="padding:10px; background:#1a1a2e; border-radius:8px; margin-bottom:5px; cursor:pointer; display:flex; align-items:center; gap:10px; border:1px solid #4cc9f0;">
                                    <span>ğŸ“</span> <span style="color:white;">/system (Ø§Ù„Ù†Ø¸Ø§Ù…) - Ù…Ù„ÙØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</span>
                                </div>
                                <div onclick="AlaisaiOS.StorageSystem.navigateTo('addons')" style="padding:10px; background:#1a1a2e; border-radius:8px; margin-bottom:5px; cursor:pointer; display:flex; align-items:center; gap:10px; border:1px solid #4ade80;">
                                    <span>ğŸ“</span> <span style="color:white;">/addons (Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª)</span>
                                </div>
                                <div id="addon-folders-list" style="margin-top:15px; padding-top:15px; border-top:2px dashed #4cc9f0;">
                                    <h4 style="color:#4ade80; margin-bottom:10px;">ğŸ“¦ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª:</h4>
                                    <div id="addon-folders-container"></div>
                                </div>
                            </div>
                            
                            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ -->
                            <div style="background:#2a2a32; border-radius:10px; padding:15px;">
                                <h3 style="color:#4cc9f0; margin-bottom:15px;" id="current-folder-title">/system</h3>
                                <div id="folder-contents" style="min-height:200px; background:#1a1a2e; border-radius:8px; padding:10px;">
                                    ${this.renderFolderContents('system')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- ØªØ­Ø°ÙŠØ± Ø§Ù„Ø£Ù…Ø§Ù† -->
                        <div style="margin-top:20px; padding:10px; background:#f7258520; border-radius:8px; border-right:3px solid #f72585; text-align:right;">
                            <p style="color:#f72585; font-size:12px;">
                                âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªÙƒØ´Ù Ù…Ø¹Ø²ÙˆÙ„ ØªÙ…Ø§Ù…Ø§Ù‹ Ø¹Ù† Ù†ÙˆØ§Ø© Ø§Ù„Ù†Ø¸Ø§Ù…. Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.
                            </p>
                        </div>
                    </div>
                `;
                
                AlaisaiOS.openApp({ 
                    name: "Ø§Ù„Ù…Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„", 
                    content: storageContent 
                });
                
                setTimeout(() => this.renderAddonFolders(), 100);
            },

            // ÙØªØ­ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù… Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
            openSystemFolder() {
                const data = this.structure;
                
                const content = `
                    <div class="admin-ui" style="direction:ltr; text-align:left; background:#1e1e26; color:white;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                            <button onclick="AlaisaiOS.StorageSystem.openStorageExplorer()" class="adm-btn" style="background:#4cc9f0;">â¬… Ø±Ø¬ÙˆØ¹</button>
                            <h3 style="color:#4cc9f0;">ğŸ“ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù… (Ù…Ù„ÙØ§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</h3>
                        </div>
                        
                        <div style="background:#2a2a32; border-radius:10px; padding:15px;">
                            <h4 style="color:#4cc9f0; margin-bottom:15px;">Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…:</h4>
                            <div style="background:#1a1a2e; border-radius:8px; padding:10px;">
                                ${data.system.files.map(f => `
                                    <div class="file-item" onclick="AlaisaiOS.StorageSystem.openFile('system', '${f.name}')">
                                        <div style="display:flex; align-items:center; gap:10px;">
                                            <span>ğŸ“„</span>
                                            <span style="color:white;">${f.name}</span>
                                            <span style="color:#4cc9f0; font-size:12px;">${f.size}</span>
                                        </div>
                                        <div class="file-actions">
                                            <button class="file-btn" onclick="event.stopPropagation(); AlaisaiOS.StorageSystem.openFile('system', '${f.name}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                                            <button class="file-btn delete" onclick="event.stopPropagation(); AlaisaiOS.StorageSystem.deleteFile('system', '${f.name}')">ğŸ—‘ Ø­Ø°Ù</button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-top:20px;">
                                <button onclick="AlaisaiOS.StorageSystem.createNewFile('system')" class="adm-btn" style="background:#4cc9f0;">â• Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</button>
                                <button onclick="AlaisaiOS.StorageSystem.saveAllSystemFiles()" class="adm-btn" style="background:#4ade80;">ğŸ’¾ Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                            </div>
                        </div>
                        
                        <!-- Ø¨ÙŠØ¦Ø© ØªØ¬Ø±Ø¨Ø© Ù…Ø¹Ø²ÙˆÙ„Ø© ÙƒØ§Ù…Ù„Ø© -->
                        <div class="isolated-lab">
                            <div class="lab-header">
                                <h4 style="color:#4cc9f0;">ğŸ§ª Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„Ø©</h4>
                                <div>
                                    <button onclick="AlaisaiOS.StorageSystem.runIsolatedCode()" class="adm-btn" style="background:#4ade80;">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯</button>
                                    <button onclick="AlaisaiOS.StorageSystem.clearIsolatedLab()" class="adm-btn" style="background:#f72585;">ğŸ—‘ Ù…Ø³Ø­</button>
                                </div>
                            </div>
                            <div style="margin-bottom:10px;">
                                <textarea id="isolated-code-editor" class="code-editor" placeholder="Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ HTML/JS Ù‡Ù†Ø§ Ù„Ù„ØªØ¬Ø±Ø¨Ø© ÙÙŠ Ø¨ÙŠØ¦Ø© Ù…Ø¹Ø²ÙˆÙ„Ø©...">${localStorage.getItem('isolated_lab_code') || '<h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©</h1>\n<script>\n  document.write("Ø§Ù„ÙˆÙ‚Øª: " + new Date().toLocaleTimeString());\n<\/script>'}</textarea>
                            </div>
                            <div class="lab-content" id="isolated-lab-output">
                                ${localStorage.getItem('isolated_lab_output') || 'Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...'}
                            </div>
                            <p style="color:#4ade80; font-size:12px; margin-top:10px;">
                                âš¡ Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ¦Ø© Ù…Ø¹Ø²ÙˆÙ„Ø© ØªÙ…Ø§Ù…Ø§Ù‹ - ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¬Ø±Ø¨Ø© Ø£ÙŠ ÙƒÙˆØ¯ Ø¨Ø£Ù…Ø§Ù†
                            </p>
                        </div>
                    </div>
                `;
                
                AlaisaiOS.openApp({ 
                    name: "ğŸ“ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù…", 
                    content: content 
                });
            },

            // ÙØªØ­ Ù…Ù„Ù Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
            openFile(folder, fileName) {
                const data = this.structure;
                const folderData = folder === 'system' ? data.system : data.addons.folders.find(f => f.name === folder);
                const file = folderData.files.find(f => f.name === fileName);
                
                if (!file) return;
                
                const content = `
                    <div class="admin-ui" style="direction:ltr; text-align:left; background:#1e1e26; color:white;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                            <button onclick="AlaisaiOS.StorageSystem.${folder === 'system' ? 'openSystemFolder' : 'openAddonFolder'}('${folder}')" class="adm-btn" style="background:#4cc9f0;">â¬… Ø±Ø¬ÙˆØ¹</button>
                            <h3 style="color:#4cc9f0;">âœï¸ ØªØ¹Ø¯ÙŠÙ„: ${fileName}</h3>
                        </div>
                        
                        <div style="background:#2a2a32; border-radius:10px; padding:15px;">
                            <textarea id="file-editor" class="code-editor" style="min-height:400px;">${file.content || ''}</textarea>
                            
                            <div style="margin-top:20px; display:flex; gap:10px;">
                                <button onclick="AlaisaiOS.StorageSystem.saveFile('${folder}', '${fileName}')" class="adm-btn" style="background:#4ade80;">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                                <button onclick="AlaisaiOS.StorageSystem.copyToLab('${folder}', '${fileName}')" class="adm-btn" style="background:#4cc9f0;">ğŸ“‹ Ù†Ø³Ø® Ø¥Ù„Ù‰ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©</button>
                                <button onclick="AlaisaiOS.StorageSystem.${folder === 'system' ? 'openSystemFolder' : 'openAddonFolder'}('${folder}')" class="adm-btn">âŒ Ø¥Ù„ØºØ§Ø¡</button>
                            </div>
                        </div>
                    </div>
                `;
                
                AlaisaiOS.openApp({ 
                    name: `âœï¸ ${fileName}`, 
                    content: content 
                });
            },

            // Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            saveFile(folder, fileName) {
                const newContent = document.getElementById('file-editor')?.value;
                if (!newContent) return;
                
                const data = this.structure;
                const folderData = folder === 'system' ? data.system : data.addons.folders.find(f => f.name === folder);
                const file = folderData.files.find(f => f.name === fileName);
                
                if (file) {
                    file.content = newContent;
                    file.size = Math.ceil(newContent.length / 1024) + 'KB';
                    localStorage.setItem('alaisai_storage_isolation', JSON.stringify(data));
                    
                    // Ø­ÙØ¸ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    localStorage.setItem(`file_backup_${fileName}`, newContent);
                    
                    alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­');
                    if (folder === 'system') {
                        this.openSystemFolder();
                    } else {
                        this.openAddonFolder(folder);
                    }
                }
            },

            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯
            createNewFile(folder) {
                const fileName = prompt("ğŸ“„ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù…Ø¹ Ø§Ù„Ø§Ù…ØªØ¯Ø§Ø¯):", "newfile.js");
                if (!fileName) return;
                
                const data = this.structure;
                const folderData = folder === 'system' ? data.system : data.addons.folders.find(f => f.name === folder);
                
                folderData.files.push({
                    name: fileName,
                    size: '1KB',
                    type: fileName.split('.').pop() || 'unknown',
                    content: '// Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯\n'
                });
                
                localStorage.setItem('alaisai_storage_isolation', JSON.stringify(data));
                alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù„Ù: ${fileName}`);
                
                if (folder === 'system') {
                    this.openSystemFolder();
                } else {
                    this.openAddonFolder(folder);
                }
            },

            // Ø­Ø°Ù Ù…Ù„Ù
            deleteFile(folder, fileName) {
                if (confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù ${fileName}ØŸ`)) {
                    const data = this.structure;
                    const folderData = folder === 'system' ? data.system : data.addons.folders.find(f => f.name === folder);
                    
                    folderData.files = folderData.files.filter(f => f.name !== fileName);
                    localStorage.setItem('alaisai_storage_isolation', JSON.stringify(data));
                    
                    alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù„Ù');
                    if (folder === 'system') {
                        this.openSystemFolder();
                    } else {
                        this.openAddonFolder(folder);
                    }
                }
            },

            // Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
            saveAllSystemFiles() {
                const data = this.structure;
                localStorage.setItem('alaisai_storage_isolation', JSON.stringify(data));
                alert('âœ… ØªÙ… Ø­ÙØ¸ Ø¬Ù…ÙŠØ¹ Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…');
            },

            // Ù†Ø³Ø® Ù…Ù„Ù Ø¥Ù„Ù‰ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©
            copyToLab(folder, fileName) {
                const data = this.structure;
                const folderData = folder === 'system' ? data.system : data.addons.folders.find(f => f.name === folder);
                const file = folderData.files.find(f => f.name === fileName);
                
                if (file && file.content) {
                    localStorage.setItem('isolated_lab_code', file.content);
                    alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¥Ù„Ù‰ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©');
                    
                    if (folder === 'system') {
                        this.openSystemFolder();
                    } else {
                        this.openAddonFolder(folder);
                    }
                }
            },

            // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©
            runIsolatedCode() {
                const code = document.getElementById('isolated-code-editor')?.value;
                if (!code) return;
                
                localStorage.setItem('isolated_lab_code', code);
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© iframe Ù…Ø¹Ø²ÙˆÙ„Ø© Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
                const output = document.getElementById('isolated-lab-output');
                if (output) {
                    output.innerHTML = `<iframe srcdoc="${this.escapeHtml(code)}" style="width:100%; height:200px; border:none; background:white; border-radius:5px;"></iframe>`;
                    localStorage.setItem('isolated_lab_output', output.innerHTML);
                }
            },

            // Ù…Ø³Ø­ Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©
            clearIsolatedLab() {
                if (document.getElementById('isolated-code-editor')) {
                    document.getElementById('isolated-code-editor').value = '<h1>Ø¨ÙŠØ¦Ø© Ø§Ù„ØªØ¬Ø±Ø¨Ø©</h1>\n<script>\n  document.write("Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„Ø©");\n<\/script>';
                }
                const output = document.getElementById('isolated-lab-output');
                if (output) {
                    output.innerHTML = 'ØªÙ… Ø§Ù„Ù…Ø³Ø­...';
                }
                localStorage.removeItem('isolated_lab_code');
                localStorage.removeItem('isolated_lab_output');
            },

            // Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙŠØ§Øª Ù…Ø¬Ù„Ø¯
            renderFolderContents(folder) {
                const data = this.structure;
                if (!data) return '<div style="color:#f72585;">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>';
                
                if (folder === 'system') {
                    if (!data.system.files || data.system.files.length === 0) {
                        return '<div style="color:#ccc; padding:20px; text-align:center;">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª ÙÙŠ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ù†Ø¸Ø§Ù…</div>';
                    }
                    return data.system.files.map(f => `
                        <div style="display:flex; justify-content:space-between; padding:8px; border-bottom:1px solid #4cc9f0; color:white;">
                            <span onclick="AlaisaiOS.StorageSystem.openFile('system', '${f.name}')" style="cursor:pointer;">ğŸ“„ ${f.name}</span>
                            <span style="color:#4cc9f0;">${f.size}</span>
                        </div>
                    `).join('');
                } else if (folder === 'addons') {
                    if (!data.addons.folders || data.addons.folders.length === 0) {
                        return '<div style="color:#ccc; padding:20px; text-align:center;">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¶Ø§ÙØ§Øª Ù…Ø¹Ø²ÙˆÙ„Ø© Ø¨Ø¹Ø¯</div>';
                    }
                    return data.addons.folders.map(folder => `
                        <div style="padding:10px; border-bottom:1px solid #4ade80; cursor:pointer;" onclick="AlaisaiOS.StorageSystem.openAddonFolder('${folder.name}')">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <span>ğŸ“</span>
                                <span style="color:white; font-weight:bold;">${folder.name}</span>
                                <span style="color:#4ade80; font-size:12px;">(${folder.files?.length || 0} Ù…Ù„Ù)</span>
                            </div>
                        </div>
                    `).join('');
                }
            },

            // ÙØªØ­ Ù…Ø¬Ù„Ø¯ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹ÙŠÙ†Ø©
            openAddonFolder(folderName) {
                const data = this.structure;
                const folder = data.addons.folders.find(f => f.name === folderName);
                
                if (!folder) return;
                
                const content = `
                    <div class="admin-ui" style="direction:ltr; text-align:left; background:#1e1e26; color:white;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:20px;">
                            <button onclick="AlaisaiOS.StorageSystem.openStorageExplorer()" class="adm-btn" style="background:#4cc9f0;">â¬… Ø±Ø¬ÙˆØ¹</button>
                            <h3 style="color:#4cc9f0;">ğŸ“ ${folderName}</h3>
                        </div>
                        
                        <div style="background:#2a2a32; border-radius:10px; padding:15px;">
                            <h4 style="color:#4ade80; margin-bottom:15px;">Ù…Ù„ÙØ§Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</h4>
                            <div style="background:#1a1a2e; border-radius:8px; padding:10px;">
                                ${!folder.files || folder.files.length === 0 ? 
                                    '<div style="color:#ccc; padding:20px; text-align:center;">ğŸ“­ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„ÙØ§Øª</div>' : 
                                    folder.files.map(f => `
                                        <div class="file-item" onclick="AlaisaiOS.StorageSystem.openFile('${folderName}', '${f.name}')">
                                            <div style="display:flex; align-items:center; gap:10px;">
                                                <span>ğŸ“„</span>
                                                <span style="color:white;">${f.name}</span>
                                                <span style="color:#4ade80; font-size:12px;">${f.size}</span>
                                            </div>
                                            <div class="file-actions">
                                                <button class="file-btn" onclick="event.stopPropagation(); AlaisaiOS.StorageSystem.openFile('${folderName}', '${f.name}')">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
                                                <button class="file-btn delete" onclick="event.stopPropagation(); AlaisaiOS.StorageSystem.deleteFile('${folderName}', '${f.name}')">ğŸ—‘ Ø­Ø°Ù</button>
                                            </div>
                                        </div>
                                    `).join('')}
                            </div>
                            
                            <div style="margin-top:20px; display:flex; gap:10px; flex-wrap:wrap;">
                                <button onclick="AlaisaiOS.StorageSystem.createNewFile('${folderName}')" class="adm-btn" style="background:#4cc9f0;">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ù</button>
                                <button onclick="AlaisaiOS.StorageSystem.deleteAddon('${folderName}')" class="adm-btn" style="background:#f72585;">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø¥Ø¶Ø§ÙØ©</button>
                            </div>
                        </div>
                        
                        <!-- Ù…Ù†Ø·Ù‚Ø© ØªØ¬Ø±ÙŠØ¨ Ø¢Ù…Ù†Ø© Ù„Ù„Ø¥Ø¶Ø§ÙØ© -->
                        <div class="isolated-lab">
                            <div class="lab-header">
                                <h4 style="color:#4cc9f0;">ğŸ§ª Ø¨ÙŠØ¦Ø© ØªØ¬Ø±Ø¨Ø© Ù…Ø¹Ø²ÙˆÙ„Ø© Ù„Ù„Ø¥Ø¶Ø§ÙØ©</h4>
                                <button onclick="AlaisaiOS.StorageSystem.runIsolatedCode()" class="adm-btn" style="background:#4ade80;">â–¶ï¸ ØªØ´ØºÙŠÙ„</button>
                            </div>
                            <textarea id="isolated-code-editor" class="code-editor" placeholder="Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ HTML/JS Ù‡Ù†Ø§ Ù„Ù„ØªØ¬Ø±Ø¨Ø©...">${localStorage.getItem('isolated_lab_code') || '// Ø¬Ø±Ø¨ ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù‡Ù†Ø§'}</textarea>
                            <div class="lab-content" id="isolated-lab-output" style="margin-top:10px;">
                                ${localStorage.getItem('isolated_lab_output') || 'Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ´ØºÙŠÙ„...'}
                            </div>
                        </div>
                    </div>
                `;
                
                AlaisaiOS.openApp({ 
                    name: `ğŸ“¦ ${folderName}`, 
                    content: content 
                });
            },

            // Ø¥Ø¶Ø§ÙØ© Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø´ÙƒÙ„ Ù…Ø¹Ø²ÙˆÙ„
            isolateAddon() {
                const addonName = prompt("ğŸ”§ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©):", "my-addon");
                if (!addonName) return;
                
                const safeName = addonName.replace(/[^a-zA-Z0-9-_]/g, '');
                if (safeName.length < 1) {
                    alert("âŒ Ø§Ø³Ù… ØºÙŠØ± ØµØ§Ù„Ø­! Ø§Ø³ØªØ®Ø¯Ù… Ø£Ø­Ø±Ù Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·");
                    return;
                }
                
                const newAddon = {
                    name: safeName,
                    path: `/addons/${safeName}`,
                    files: [
                        { name: 'manifest.json', size: '1KB', type: 'json', content: '{\n  "name": "'+safeName+'",\n  "version": "1.0.0",\n  "description": "Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø²ÙˆÙ„Ø©"\n}' },
                        { name: 'main.js', size: '2KB', type: 'javascript', content: '// ÙƒÙˆØ¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„Ø©\nfunction init() {\n  console.log("Ø§Ù„Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù…Ù„");\n}\n\ninit();' },
                        { name: 'style.css', size: '1KB', type: 'css', content: '/* Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¥Ø¶Ø§ÙØ© */\n.addon-container {\n  padding: 10px;\n  background: #f0f0f0;\n}' }
                    ],
                    isolated: true
                };
                
                if (!this.structure.addons.folders) {
                    this.structure.addons.folders = [];
                }
                
                this.structure.addons.folders.push(newAddon);
                localStorage.setItem(`addon_${safeName}_isolated`, JSON.stringify(newAddon));
                localStorage.setItem('alaisai_storage_isolation', JSON.stringify(this.structure));
                
                alert(`âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ù…Ø¹Ø²ÙˆÙ„ Ù„Ù„Ø¥Ø¶Ø§ÙØ©: ${safeName}`);
                this.openStorageExplorer();
            },

            // Ø¹Ø±Ø¶ Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª
            renderAddonFolders() {
                const container = document.getElementById('addon-folders-container');
                if (!container || !this.structure.addons.folders) return;
                
                if (this.structure.addons.folders.length === 0) {
                    container.innerHTML = '<div style="color:#ccc; padding:10px; text-align:center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¶Ø§ÙØ§Øª</div>';
                    return;
                }
                
                container.innerHTML = this.structure.addons.folders.map(folder => `
                    <div onclick="AlaisaiOS.StorageSystem.openAddonFolder('${folder.name}')" style="padding:8px; background:#1a1a2e; border-radius:5px; margin-bottom:5px; cursor:pointer; display:flex; align-items:center; gap:8px; border:1px solid #4ade80;">
                        <span>ğŸ“¦</span>
                        <span style="color:white; font-size:13px;">${folder.name}</span>
                        <span style="color:#4ade80; font-size:11px; margin-right:auto;">Ù…Ø¹Ø²ÙˆÙ„</span>
                    </div>
                `).join('');
            },

            // Ø­Ø°Ù Ø¥Ø¶Ø§ÙØ©
            deleteAddon(addonName) {
                if (confirm(`âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¥Ø¶Ø§ÙØ© ${addonName}ØŸ\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù…Ø¹Ø²ÙˆÙ„ ÙˆÙ„Ù† ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù….`)) {
                    this.structure.addons.folders = this.structure.addons.folders.filter(f => f.name !== addonName);
                    localStorage.removeItem(`addon_${addonName}_isolated`);
                    localStorage.setItem('alaisai_storage_isolation', JSON.stringify(this.structure));
                    alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¨Ù†Ø¬Ø§Ø­');
                    this.openStorageExplorer();
                }
            },

            refresh() {
                this.openStorageExplorer();
            },

            navigateTo(path) {
                this.openStorageExplorer();
            },

            // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø§Ù„Ø¢Ù…Ù†
            escapeHtml(text) {
                return text.replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            }
        }
    };

    // ========== Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© ==========
    const Admin = {
        requestAccess() {
            const p = prompt("ğŸ” ÙˆØ¶Ø¹ Ø§Ù„Ù…ØµÙ…Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ: Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");
            if (p === AlaisaiOS.db.config.pass) {
                this.openDashboard();
            } else if (p !== null) {
                alert("âŒ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!");
            }
        },

        openDashboard() {
            const content = `
                <div class="admin-ui">
                    <h2 style="border-bottom:2px solid #4cc9f0; padding-bottom:10px;">ğŸ›  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</h2>
                    <div style="display:flex; gap:5px; margin-bottom:15px; flex-wrap:wrap;">
                        <button class="adm-btn" onclick="Admin.renderTab('layout')">ğŸ“± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©</button>
                        <button class="adm-btn" onclick="Admin.renderTab('msg')">ğŸ“© Ø§Ù„Ù…Ø±Ø§Ø³Ù„Ø©</button>
                        <button class="adm-btn" onclick="Admin.renderTab('sys')">âš™ï¸ Ø§Ù„Ù†Ø¸Ø§Ù…</button>
                        <button class="adm-btn" onclick="Admin.renderTab('backup')">ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</button>
                        <button class="adm-btn" onclick="Admin.renderTab('storage')" style="background:#4cc9f0; color:black;">ğŸ“ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„</button>
                    </div>
                    <div id="admin-view" style="background:rgba(255,255,255,0.1); padding:15px; border-radius:12px; min-height:250px;"></div>
                </div>
            `;
            AlaisaiOS.openApp({ name: "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù…", content: content });
            setTimeout(() => this.renderTab('layout'), 100);
        },

        renderTab(tab) {
            const view = document.getElementById('admin-view');
            if (!view) return;
            
            if (tab === 'layout') {
                let list = "<h4>ğŸ“± ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± (Ø§Ø³Ø­Ø¨ Ù„Ù„ØªØ±ØªÙŠØ¨):</h4>";
                AlaisaiOS.db.registry.forEach((app, i) => {
                    list += `
                        <div class="admin-row" draggable="true" ondragstart="Admin.drag(${i})" ondrop="Admin.drop(${i})" ondragover="event.preventDefault()">
                            <input type="text" id="in_${app.id}" value="${app.name.replace(/"/g, '&quot;')}" style="width:80px; margin-left:5px;">
                            <button onclick="Admin.saveName('${app.id}')" id="sav_${app.id}" class="btn-save-mini">â˜‘ï¸</button>
                            <button onclick="Admin.editIcon('${app.id}')" style="margin:0 5px;background:rgba(76,201,240,0.2);border:none;border-radius:5px;padding:5px;">${app.icon}</button>
                            <button onclick="Admin.deleteApp('${app.id}')" style="background:#f72585; color:white; border:none; border-radius:4px; padding:5px 10px;">ğŸ—‘</button>
                        </div>
                    `;
                });
                list += `<button onclick="Admin.addNew()" style="width:100%; margin-top:10px; background:#4ade80; border:none; padding:10px; border-radius:8px; color:white; font-weight:bold;">â• Ø¥Ø¶Ø§ÙØ© ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯</button>`;
                view.innerHTML = list;
            }
            else if (tab === 'msg') {
                view.innerHTML = `
                    <h4>ğŸ“© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ù…Ø±Ø§Ø³Ù„Ø©:</h4>
                    <p>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: <b>${AlaisaiOS.db.config.downloads}</b></p>
                    <div style="max-height:150px; overflow-y:auto; background:rgba(255,255,255,0.2); padding:10px; border-radius:8px;">
                        ${AlaisaiOS.db.config.reports.map(r => `
                            <div style="border-bottom:1px solid rgba(255,255,255,0.1); padding:5px 0;">
                                <small>${r.email}</small> 
                                <button onclick="Admin.copy('${r.email}')" class="btn-save-mini">Ù†Ø³Ø®</button>
                                <p style="margin:5px 0;">${r.text}</p>
                            </div>
                        `).join('')}
                    </div>
                    <input type="email" id="reply_mail" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ„Ù…" style="width:100%; margin-top:10px; padding:8px;">
                    <textarea id="reply_msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø¯Ùƒ Ù‡Ù†Ø§..." style="width:100%; height:50px; margin-top:5px; padding:8px;"></textarea>
                    <button onclick="alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ø¨Ù†Ø¬Ø§Ø­');" style="width:100%; background:#4cc9f0; border:none; color:white; padding:8px; margin-top:5px; border-radius:5px;">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯</button>
                `;
            }
            else if (tab === 'sys') {
                view.innerHTML = `
                    <h4>âš™ï¸ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©:</h4>
                    <button class="adm-btn" onclick="Admin.changePass()">ğŸ” ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                    <button class="adm-btn" onclick="Admin.exportData()">ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… (Backup)</button>
                    <button class="adm-btn" onclick="Admin.importData()">ğŸ“¤ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</button>
                    <button class="adm-btn" onclick="Admin.resetSystem()">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…ØµÙ†Ø¹</button>
                    <button class="adm-btn" onclick="Admin.cloudSync()" id="sync_btn">â˜ï¸ Ø±Ø¨Ø· Ø³Ø­Ø§Ø¨ÙŠ</button>
                `;
            }
            else if (tab === 'backup') {
                const autoBackup = localStorage.getItem(AUTO_BACKUP_KEY);
                let backupInfo = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©';
                if (autoBackup) {
                    try {
                        const backup = JSON.parse(autoBackup);
                        backupInfo = `Ø¢Ø®Ø± Ù†Ø³Ø®Ø©: ${new Date(backup.timestamp).toLocaleString('ar-SA')}`;
                    } catch (e) {}
                }
                view.innerHTML = `
                    <h4>ğŸ’¾ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</h4>
                    <p>${backupInfo}</p>
                    <button class="adm-btn" onclick="Admin.restoreAutoBackup()">â†©ï¸ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¢Ø®Ø± Ù†Ø³Ø®Ø©</button>
                    <button class="adm-btn" onclick="Admin.exportData()">ğŸ“¥ Ù†Ø³Ø®Ø© ÙŠØ¯ÙˆÙŠØ©</button>
                `;
            }
            else if (tab === 'storage') {
                view.innerHTML = `
                    <div style="text-align:center; padding:20px;">
                        <h4 style="color:#4cc9f0; margin-bottom:20px;">ğŸ“ Ø§Ù„Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø¹Ø²ÙˆÙ„ Ù„Ù„Ù†Ø¸Ø§Ù…</h4>
                        <p style="margin-bottom:20px;">Ù‡Ø°Ø§ Ø§Ù„Ù…Ø®Ø²Ù† Ù…Ø¹Ø²ÙˆÙ„ ØªÙ…Ø§Ù…Ø§Ù‹ Ø¹Ù† Ù†ÙˆØ§Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</p>
                        
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-bottom:20px;">
                            <div style="background:rgba(76,201,240,0.1); border:1px solid #4cc9f0; border-radius:10px; padding:15px; cursor:pointer;" onclick="AlaisaiOS.StorageSystem.openSystemFolder()">
                                <div style="font-size:3rem; margin-bottom:10px;">ğŸ“</div>
                                <h5 style="color:#4cc9f0;">Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h5>
                                <p style="font-size:12px;">ÙØªØ­ ÙˆØªØ¹Ø¯ÙŠÙ„ Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</p>
                            </div>
                            
                            <div style="background:rgba(74,222,128,0.1); border:1px solid #4ade80; border-radius:10px; padding:15px; cursor:pointer;" onclick="AlaisaiOS.StorageSystem.isolateAddon()">
                                <div style="font-size:3rem; margin-bottom:10px;">â•</div>
                                <h5 style="color:#4ade80;">Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø²ÙˆÙ„Ø©</h5>
                                <p style="font-size:12px;">Ø¥Ù†Ø´Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù…Ø¬Ù„Ø¯ Ù…Ù†ÙØµÙ„</p>
                            </div>
                        </div>
                        
                        <div style="background:rgba(255,255,255,0.05); border-radius:10px; padding:15px;">
                            <h6 style="margin-bottom:10px;">ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†:</h6>
                            <div style="display:flex; justify-content:space-between; font-size:13px;">
                                <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ§Øª: ${AlaisaiOS.StorageSystem.structure?.addons?.folders?.length || 0}</span>
                                <span>Ù…Ù„ÙØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…: ${AlaisaiOS.StorageSystem.structure?.system?.files?.length || 0}</span>
                            </div>
                        </div>
                        
                        <div style="margin-top:20px; padding:10px; background:#f7258520; border-radius:8px; border-right:3px solid #f72585; text-align:right;">
                            <p style="color:#f72585; font-size:12px;">
                                âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ù…Ø¹Ø²ÙˆÙ„ ØªÙ…Ø§Ù…Ø§Ù‹ - Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ù†Ø§ Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…
                            </p>
                        </div>
                    </div>
                `;
            }
        },

        saveName(id) {
            const app = AlaisaiOS.db.registry.find(a => a.id === id);
            if (app) {
                app.name = document.getElementById('in_'+id).value;
                AlaisaiOS.save();
                AlaisaiOS.renderDesktop();
                const b = document.getElementById('sav_'+id);
                b.innerText = "âœ…";
                b.style.background = "#4ade80";
                setTimeout(() => { b.innerText = "â˜‘ï¸"; b.style.background = "#4cc9f0"; }, 1500);
            }
        },

        editIcon(id) {
            const app = AlaisaiOS.db.registry.find(a => a.id === id);
            const icon = prompt("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© (Emoji):", app.icon);
            if (icon) {
                app.icon = icon;
                AlaisaiOS.save();
                AlaisaiOS.renderDesktop();
                this.renderTab('layout');
            }
        },

        deleteApp(id) {
            if (confirm("âš ï¸ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
                AlaisaiOS.db.registry = AlaisaiOS.db.registry.filter(a => a.id !== id);
                AlaisaiOS.save();
                AlaisaiOS.renderDesktop();
                this.renderTab('layout');
            }
        },

        addNew() {
            const name = prompt("Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
            const code = prompt("Ø£Ù„ØµÙ‚ ÙƒÙˆØ¯ HTML/JS Ù‡Ù†Ø§:");
            if (name && code) {
                AlaisaiOS.db.registry.push({
                    id: 'app_' + Date.now() + '_' + Math.random().toString(36).substr(2, 5),
                    name: name,
                    icon: 'ğŸ“¦',
                    content: code,
                    order: AlaisaiOS.db.registry.length
                });
                AlaisaiOS.save();
                AlaisaiOS.renderDesktop();
                this.renderTab('layout');
            }
        },

        exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(AlaisaiOS.db, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", `alaisai_backup_${new Date().toISOString().slice(0,10)}.json`);
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        },

        importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = readerEvent => {
                    try {
                        const content = JSON.parse(readerEvent.target.result);
                        if (content.registry && content.config) {
                            AlaisaiOS.db = content;
                            AlaisaiOS.save();
                            alert('âœ… ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù†Ø³Ø®Ø© Ø¨Ù†Ø¬Ø§Ø­ØŒ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„');
                            location.reload();
                        } else {
                            alert('âŒ Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­');
                        }
                    } catch (err) {
                        alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        },

        restoreAutoBackup() {
            try {
                const backup = JSON.parse(localStorage.getItem(AUTO_BACKUP_KEY));
                if (backup && backup.data) {
                    AlaisaiOS.db = backup.data;
                    AlaisaiOS.save();
                    alert('âœ… ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø¢Ø®Ø± Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©');
                    location.reload();
                }
            } catch (e) {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ØµØ§Ù„Ø­Ø©');
            }
        },

        resetSystem() {
            if (confirm('âš ï¸ ØªØ­Ø°ÙŠØ±! Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ')) {
                localStorage.removeItem('alaisai_ultra_db');
                localStorage.removeItem(AUTO_BACKUP_KEY);
                alert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù†Ø¸Ø§Ù…');
                location.reload();
            }
        },

        cloudSync() {
            const btn = document.getElementById('sync_btn');
            if (btn) {
                btn.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø¨Ø·...";
                btn.disabled = true;
                setTimeout(() => {
                    btn.innerText = "â˜ï¸ ØªÙ… Ø§Ù„Ø±Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­";
                    btn.style.background = "#4ade80";
                    btn.disabled = false;
                    setTimeout(() => {
                        btn.style.background = "";
                        btn.innerText = "â˜ï¸ Ø±Ø¨Ø· Ø³Ø­Ø§Ø¨ÙŠ";
                    }, 3000);
                }, 2000);
            }
        },

        changePass() {
            const n = prompt("ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:");
            if (n) {
                AlaisaiOS.db.config.pass = n;
                AlaisaiOS.save();
                alert("âœ… ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­");
            }
        },

        copy(t) {
            navigator.clipboard.writeText(t).then(() => alert("âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!"));
        },

        adminDragIdx: null,
        drag(i) {
            this.adminDragIdx = i;
        },
        drop(target) {
            const items = AlaisaiOS.db.registry;
            if (this.adminDragIdx !== null && this.adminDragIdx !== target) {
                const [moved] = items.splice(this.adminDragIdx, 1);
                items.splice(target, 0, moved);
                items.forEach((item, idx) => item.order = idx);
                AlaisaiOS.save();
                AlaisaiOS.renderDesktop();
                this.renderTab('layout');
            }
        }
    };

    // Ø±Ø¨Ø· Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
    window.AlaisaiOS = AlaisaiOS;
    window.Admin = Admin;

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
    window.onload = () => AlaisaiOS.init();
</script>

<!-- ØªØ³Ø¬ÙŠÙ„ Service Worker -->
<script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('./sw.js')
                .then(reg => console.log('âœ… PWA: Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª'))
                .catch(err => console.log('âŒ PWA: ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø¯Ù…Ø©', err));
        });
    }
</script>

</body>
</html>
